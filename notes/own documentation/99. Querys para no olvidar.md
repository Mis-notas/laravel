~~~PHP
 $overallQuery = Venue::select('id', 'name', 'active')      ->join('user_customer', 'venues.customer_id', '=', 'user_customer.customer_id')      ->where('user_customer.user_id', $id)      ->whereNotExists(function ($query) use ($id) {          $query->select(DB::raw(1))->from('customers')              ->join('venues AS v','customers.id', '=', 'v.customer_id')              ->where('v.id','venues.id')->where('v.name','venues.name')->where('v.active','venues.active')              ->whereExists(function ($query) use ($id) {                  $query->select('venues.customer_id')->from('venues')->join('assigned_venue', 'venues.id', '=', 'assigned_venue.venue_id')                      ->where('user_id', $id)->where('venues.customer_id', 'customers.id');              })              ->whereNotExists(function ($query) use ($id){                  $query->select(DB::raw(1))->from('venues as v')                      ->join('assigned_venue', 'v.id', '=', 'assigned_venue.venue_id')                      ->where('user_id',$id )                      ->where('v.id','venues.id')->where('v.name','venues.name')->where('v.active','venues.active');              });      })      ->orderBy('name')      ->dd();
~~~

Asi se ve
![[Query Venues compleja.png]]

